---
title: "cxhull"
author: ""
date: "2018-06-21"
output:
  github_document:
  html_document:
    toc: yes
    keep_md: no
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE)
```

The purpose of the `cxhull` package is to compute the convex hull of a set of
points in arbitrary dimension.
It contains only one function: `cxhull`.

The output of the `cxhull` function is a list with the following fields.

- `vertices`: The vertices of the convex hull. Each vertex is given with its
neighbour vertices, its neighbour ridges and its neighbour facets.

- `edges`: The edges of the convex hull, given as pairs of vertices
identifiants.

- `ridges`: The ridges of the convex hull, i.e. the elements of the convex hull
of dimension `dim-2`. Thus the ridges are just the vertices in dimension 2, and
they are the edges in dimension 3.

- `facets`: The facets of the convex hull, i.e. the elements of the convex hull
of dimension `dim-1`. Thus the facets are the edges in dimension 2, and they
are the faces of the convex polyhedron in dimension 3.

- `volume`: The volume of the convex hull
(area in dimension 2, volume in dimension 3, hypervolume in higher dimension).

Let's look at an example. The points we take are the vertices of a cube and
the center of this cube (in the first row):

```{r}
library(cxhull)
points <- rbind(
  c(0.5, 0.5, 0.5),
  c(0, 0, 0),
  c(0, 0, 1),
  c(0, 1, 0),
  c(0, 1, 1),
  c(1, 0, 0),
  c(1, 0, 1),
  c(1, 1, 0),
  c(1, 1, 1)
)
hull <- cxhull(points)
```

Obviously, the convex hull of these points is the cube.
We can quickly see that the convex hull has 8 vertices, 12 edges, 12 ridges,
6 facets, and its volume is 1:

```{r}
str(hull, max=1)
```

Each vertex, each ridge, and each facet has an identifier.
A vertex identifier is the index of the row corresponding to
this vertex in the set of points passed to the `cxhull` function.
It is given in the field `id` of the vertex:

```{r}
hull$vertices[[1]]
```

Also, the list of vertices is named with the identifiers:

```{r}
names(hull$vertices)
```

Edges are given as a matrix, each row representing an edge given as a pair of
vertices identifiers:

```{r}
hull$edges
```

The ridges are given as a list:

```{r}
hull$ridges[[1]]
```

The `vertices` field provides the vertices identifiers of the ridge.
A ridge is between two facets. The identifiers of these facets are given in
the field `ridgeOf`.

Facets are given as a list:

```{r}
hull$facets[[1]]
```

There is no `id` field for the facets: the integer `i` is the identifier of
the `i`-th facet of the list.

Here, the `family` field is `NA` for every facet:

```{r}
sapply(hull$facets, `[[`, "family")
```

This field has a possibly non-missing value only when one requires the
triangulation of the convex hull:

```{r}
thull <- cxhull(points, triangulate = TRUE)
sapply(thull$facets, `[[`, "family")
```

The hull is triangulated into 12 triangles: each face of the cube is
triangulated into two triangles.
Therefore one gets six different families, each one consisting of two
triangles: two triangles belong to the same family mean that they are parts of
the same facet of the non-triangulated hull.

The triangulation is useful to plot a 3-dimensional hull:

```{r, eval=FALSE}
library(rgl)
# generates 50 points in the unit sphere (uniformly):
npoints <- 50
r <- runif(npoints)^(1/3)
theta <- runif(npoints, 0, 2*pi)
cosphi <- runif(npoints, -1, 1)
points <- t(mapply(function(r,theta,cosphi){
  r * c(cos(theta)*sin(acos(cosphi)), sin(theta)*sin(acos(cosphi)), cosphi)
}, r, theta, cosphi))
# computes the triangulated convex hull:
h <- cxhull(points, triangulate = TRUE)
# plot:
for(i in 1:length(h$facets)){
  triangle <- t(sapply(h$facets[[i]]$vertices,
                       function(id) h$vertices[[as.character(id)]]$point))
  triangles3d(triangle, color="blue")
}
```

![Imgur](https://i.imgur.com/9Awcfg7.png)


## Ordonning the vertices

Observe the vertices of the first face of the cube:

```{r}
hull$facets[[1]]$vertices
```

They are given as `2-4-6-8`.
They are not ordered, in the sense that `4-6` and `8-2` are not edges of this
face:

```{r}
( face_edges <- hull$facets[[1]]$edges )
```

One can order the vertices with the help of the `igraph` package as follows:

```{r, message=FALSE}
library(igraph)
g <- graph_from_edgelist(apply(face_edges, 2, as.character))
biconnected_components(g)$components[[1]]
```
